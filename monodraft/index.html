<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MonoDraft - Distraction-Free Writing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #1a1a1a;
            --text-secondary: #6c757d;
            --border-color: #e0e0e0;
            --accent: #5c7cfa;
            --code-bg: #f4f4f4;
            --toolbar-bg: rgba(255, 255, 255, 0.95);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #3a3a3a;
            --accent: #748ffc;
            --code-bg: #2a2a2a;
            --toolbar-bg: rgba(26, 26, 26, 0.95);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--toolbar-bg);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            z-index: 100;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .header.hidden {
            transform: translateY(-100%);
            opacity: 0;
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        button {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        button:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        button.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .toolbar {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--toolbar-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            display: flex;
            gap: 4px;
            z-index: 99;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .toolbar.faded {
            opacity: 0.2;
        }

        .toolbar:hover {
            opacity: 1 !important;
        }

        .toolbar button {
            padding: 6px 10px;
            font-size: 13px;
            background: transparent;
            border: 1px solid transparent;
        }

        .toolbar button:hover {
            background: var(--bg-secondary);
            border-color: var(--border-color);
            transform: none;
        }

        .toolbar button.active {
            background: var(--accent);
            color: white;
        }

        .toolbar .separator {
            width: 1px;
            background: var(--border-color);
            margin: 4px;
        }

        .container {
            max-width: 750px;
            margin: 0 auto;
            padding: 120px 20px 40px;
            min-height: 100vh;
        }

        .editor-wrapper {
            background: var(--bg-primary);
            border-radius: 8px;
            min-height: 500px;
        }

        .tiptap {
            outline: none;
            min-height: 500px;
            font-size: 18px;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .tiptap h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin: 1em 0 0.5em;
            line-height: 1.2;
        }

        .tiptap h2 {
            font-size: 2em;
            font-weight: 600;
            margin: 1em 0 0.5em;
            line-height: 1.3;
        }

        .tiptap h3 {
            font-size: 1.5em;
            font-weight: 600;
            margin: 1em 0 0.5em;
        }

        .tiptap h4, .tiptap h5, .tiptap h6 {
            font-size: 1.2em;
            font-weight: 600;
            margin: 1em 0 0.5em;
        }

        .tiptap p {
            margin: 0 0 1em;
        }

        .tiptap ul, .tiptap ol {
            padding-left: 1.5em;
            margin: 0 0 1em;
        }

        .tiptap li {
            margin: 0.25em 0;
        }

        .tiptap blockquote {
            border-left: 4px solid var(--accent);
            padding-left: 1em;
            margin: 1em 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        .tiptap pre {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1em;
            margin: 1em 0;
            overflow-x: auto;
        }

        .tiptap code {
            background: var(--code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: 0.9em;
        }

        .tiptap pre code {
            background: transparent;
            padding: 0;
        }

        .tiptap a {
            color: var(--accent);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }

        .tiptap a:hover {
            border-bottom-color: var(--accent);
        }

        .tiptap hr {
            border: none;
            border-top: 2px solid var(--border-color);
            margin: 2em 0;
        }

        .tiptap img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            margin: 1em 0;
        }

        .code-view {
            display: none;
            width: 100%;
            min-height: 500px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.6;
            background: var(--code-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            resize: vertical;
            outline: none;
        }

        .code-view.active {
            display: block;
        }

        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--toolbar-bg);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .status-bar .status-left {
            display: flex;
            gap: 20px;
        }

        .status-bar .status-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .export-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: none;
            min-width: 180px;
        }

        .export-menu.active {
            display: block;
        }

        .export-menu button {
            width: 100%;
            text-align: left;
            margin-bottom: 4px;
            background: transparent;
            border: none;
            padding: 8px 12px;
        }

        .export-menu button:last-child {
            margin-bottom: 0;
        }

        .export-menu button:hover {
            background: var(--bg-secondary);
        }

        .back-link {
            position: fixed;
            bottom: 60px;
            right: 20px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            transition: all 0.2s ease;
            z-index: 101;
        }

        .back-link:hover {
            color: var(--accent);
            border-color: var(--accent);
        }

        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .toast.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 100px 15px 40px;
            }

            .toolbar {
                top: 60px;
                left: 10px;
                right: 10px;
                transform: none;
                flex-wrap: wrap;
            }

            .header-actions {
                flex-wrap: wrap;
            }

            .tiptap {
                font-size: 16px;
            }
        }

        /* Focus mode styles */
        body.focus-mode .header,
        body.focus-mode .status-bar,
        body.focus-mode .back-link {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        body.focus-mode .toolbar {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        body.focus-mode .toolbar:hover,
        body.focus-mode .header:hover,
        body.focus-mode .status-bar:hover,
        body.focus-mode .back-link:hover {
            opacity: 1;
            pointer-events: all;
        }

        /* Focus mode trigger zone at top */
        .focus-trigger {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            z-index: 98;
            pointer-events: none;
        }

        body.focus-mode .focus-trigger {
            pointer-events: all;
        }

        body.focus-mode .focus-trigger:hover ~ .header,
        body.focus-mode .focus-trigger:hover ~ .toolbar,
        body.focus-mode .focus-trigger:hover ~ .status-bar,
        body.focus-mode .focus-trigger:hover ~ .back-link {
            opacity: 1;
            pointer-events: all;
        }

        /* Typing indicator */
        body.typing .toolbar:not(:hover) {
            opacity: 0.2;
        }

        /* Print styles */
        @media print {
            .header,
            .toolbar,
            .status-bar,
            .back-link {
                display: none;
            }

            .container {
                padding: 0;
                max-width: 100%;
            }

            .tiptap {
                font-size: 12pt;
            }
        }
    </style>
</head>
<body>
    <div class="focus-trigger"></div>
    <header class="header">
        <div class="header-content">
            <div class="brand">MonoDraft</div>
            <div class="header-actions">
                <button id="viewToggle">Code View</button>
                <button id="themeToggle">üåô</button>
                <button id="focusToggle">Focus Mode</button>
                <div style="position: relative;">
                    <button id="exportBtn">Export ‚Üì</button>
                    <div class="export-menu" id="exportMenu">
                        <button id="copyHtml">Copy as HTML</button>
                        <button id="copyMarkdown">Copy as Markdown</button>
                        <button id="downloadHtml">Download HTML</button>
                        <button id="downloadMarkdown">Download Markdown</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="toolbar" id="toolbar">
        <button data-action="bold" title="Bold (Cmd/Ctrl+B)"><strong>B</strong></button>
        <button data-action="italic" title="Italic (Cmd/Ctrl+I)"><em>I</em></button>
        <button data-action="underline" title="Underline (Cmd/Ctrl+U)"><u>U</u></button>
        <button data-action="strike" title="Strikethrough"><s>S</s></button>
        <div class="separator"></div>
        <button data-action="heading1" title="Heading 1">H1</button>
        <button data-action="heading2" title="Heading 2">H2</button>
        <button data-action="heading3" title="Heading 3">H3</button>
        <div class="separator"></div>
        <button data-action="bulletList" title="Bullet List">‚Ä¢ List</button>
        <button data-action="orderedList" title="Ordered List">1. List</button>
        <button data-action="blockquote" title="Blockquote">" Quote</button>
        <button data-action="codeBlock" title="Code Block">&lt;/&gt;</button>
        <div class="separator"></div>
        <button data-action="link" title="Add Link">üîó</button>
        <button data-action="horizontalRule" title="Horizontal Rule">‚Äî</button>
        <button data-action="undo" title="Undo (Cmd/Ctrl+Z)">‚Ü∂</button>
        <button data-action="redo" title="Redo (Cmd/Ctrl+Shift+Z)">‚Ü∑</button>
    </div>

    <main class="container">
        <div class="editor-wrapper">
            <div id="editor" class="tiptap"></div>
            <textarea id="codeView" class="code-view"></textarea>
        </div>
    </main>

    <footer class="status-bar">
        <div class="status-left">
            <span id="wordCount">0 words</span>
            <span id="charCount">0 characters</span>
            <span id="saveStatus">Saved</span>
        </div>
        <div class="status-right">
            <span id="currentTime"></span>
        </div>
    </footer>

    <a href="../index.html" class="back-link">‚Üê Back</a>

    <div class="toast" id="toast"></div>

    <!-- Load Tiptap from CDN -->
    <script type="module">
        import { Editor } from 'https://cdn.jsdelivr.net/npm/@tiptap/core@2.1.13/+esm';
        import StarterKit from 'https://cdn.jsdelivr.net/npm/@tiptap/starter-kit@2.1.13/+esm';
        import Link from 'https://cdn.jsdelivr.net/npm/@tiptap/extension-link@2.1.13/+esm';
        import Underline from 'https://cdn.jsdelivr.net/npm/@tiptap/extension-underline@2.1.13/+esm';
        import Image from 'https://cdn.jsdelivr.net/npm/@tiptap/extension-image@2.1.13/+esm';

        // Load Turndown for HTML to Markdown conversion
        const turndownScript = document.createElement('script');
        turndownScript.src = 'https://unpkg.com/turndown/dist/turndown.js';
        document.head.appendChild(turndownScript);

        turndownScript.onload = function() {
            // Initialize the app after Turndown loads
            initializeApp();
        };

        function initializeApp() {
            const turndownService = new TurndownService({
                headingStyle: 'atx',
                codeBlockStyle: 'fenced'
            });

            // State
            let currentView = 'visual';
            let isTyping = false;
            let typingTimer;
            let saveTimer;
            let editor;

            // Initialize editor
            editor = new Editor({
                element: document.querySelector('#editor'),
                extensions: [
                    StarterKit,
                    Link.configure({
                        openOnClick: false,
                    }),
                    Underline,
                    Image,
                ],
                content: localStorage.getItem('monoDraftContent') || `
                    <h1>Welcome to MonoDraft</h1>
                    <p>Start writing your thoughts in this distraction-free environment. All your work is automatically saved locally.</p>
                    <p>Use the toolbar above or keyboard shortcuts to format your text:</p>
                    <ul>
                        <li><strong>Bold:</strong> Cmd/Ctrl + B</li>
                        <li><em>Italic:</em> Cmd/Ctrl + I</li>
                        <li><u>Underline:</u> Cmd/Ctrl + U</li>
                    </ul>
                    <blockquote>Focus on what matters most - your writing.</blockquote>
                `,
                onUpdate: ({ editor }) => {
                    updateStats();
                    autoSave();

                    // Handle typing indicator
                    document.body.classList.add('typing');
                    clearTimeout(typingTimer);
                    typingTimer = setTimeout(() => {
                        document.body.classList.remove('typing');
                    }, 1000);
                },
            });

            // Toolbar actions
            document.querySelectorAll('.toolbar button[data-action]').forEach(button => {
                button.addEventListener('click', () => {
                    const action = button.dataset.action;
                    handleToolbarAction(action);
                });
            });

            function handleToolbarAction(action) {
                switch(action) {
                    case 'bold':
                        editor.chain().focus().toggleBold().run();
                        break;
                    case 'italic':
                        editor.chain().focus().toggleItalic().run();
                        break;
                    case 'underline':
                        editor.chain().focus().toggleUnderline().run();
                        break;
                    case 'strike':
                        editor.chain().focus().toggleStrike().run();
                        break;
                    case 'heading1':
                        editor.chain().focus().toggleHeading({ level: 1 }).run();
                        break;
                    case 'heading2':
                        editor.chain().focus().toggleHeading({ level: 2 }).run();
                        break;
                    case 'heading3':
                        editor.chain().focus().toggleHeading({ level: 3 }).run();
                        break;
                    case 'bulletList':
                        editor.chain().focus().toggleBulletList().run();
                        break;
                    case 'orderedList':
                        editor.chain().focus().toggleOrderedList().run();
                        break;
                    case 'blockquote':
                        editor.chain().focus().toggleBlockquote().run();
                        break;
                    case 'codeBlock':
                        editor.chain().focus().toggleCodeBlock().run();
                        break;
                    case 'link':
                        const url = window.prompt('Enter URL:');
                        if (url) {
                            editor.chain().focus().setLink({ href: url }).run();
                        }
                        break;
                    case 'horizontalRule':
                        editor.chain().focus().setHorizontalRule().run();
                        break;
                    case 'undo':
                        editor.chain().focus().undo().run();
                        break;
                    case 'redo':
                        editor.chain().focus().redo().run();
                        break;
                }
                updateToolbarState();
            }

            // Update toolbar button states
            function updateToolbarState() {
                document.querySelectorAll('.toolbar button[data-action]').forEach(button => {
                    const action = button.dataset.action;
                    button.classList.remove('active');

                    switch(action) {
                        case 'bold':
                            if (editor.isActive('bold')) button.classList.add('active');
                            break;
                        case 'italic':
                            if (editor.isActive('italic')) button.classList.add('active');
                            break;
                        case 'underline':
                            if (editor.isActive('underline')) button.classList.add('active');
                            break;
                        case 'strike':
                            if (editor.isActive('strike')) button.classList.add('active');
                            break;
                        case 'heading1':
                            if (editor.isActive('heading', { level: 1 })) button.classList.add('active');
                            break;
                        case 'heading2':
                            if (editor.isActive('heading', { level: 2 })) button.classList.add('active');
                            break;
                        case 'heading3':
                            if (editor.isActive('heading', { level: 3 })) button.classList.add('active');
                            break;
                        case 'bulletList':
                            if (editor.isActive('bulletList')) button.classList.add('active');
                            break;
                        case 'orderedList':
                            if (editor.isActive('orderedList')) button.classList.add('active');
                            break;
                        case 'blockquote':
                            if (editor.isActive('blockquote')) button.classList.add('active');
                            break;
                        case 'codeBlock':
                            if (editor.isActive('codeBlock')) button.classList.add('active');
                            break;
                    }
                });
            }

            // View toggle
            document.getElementById('viewToggle').addEventListener('click', () => {
                toggleView();
            });

            function toggleView() {
                if (currentView === 'visual') {
                    // Switch to code view
                    const html = editor.getHTML();
                    const markdown = turndownService.turndown(html);
                    document.getElementById('codeView').value = markdown;
                    document.getElementById('editor').style.display = 'none';
                    document.getElementById('codeView').classList.add('active');
                    document.getElementById('toolbar').style.display = 'none';
                    document.getElementById('viewToggle').textContent = 'Visual View';
                    currentView = 'code';
                } else {
                    // Switch to visual view
                    document.getElementById('editor').style.display = 'block';
                    document.getElementById('codeView').classList.remove('active');
                    document.getElementById('toolbar').style.display = 'flex';
                    document.getElementById('viewToggle').textContent = 'Code View';
                    currentView = 'visual';

                    // Note: Converting markdown back to HTML would require a markdown parser
                    // For now, we keep the HTML as is
                }
            }

            // Theme toggle
            const themeToggle = document.getElementById('themeToggle');
            const savedTheme = localStorage.getItem('monoDraftTheme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
            }

            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('monoDraftTheme', newTheme);
                themeToggle.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            });

            // Focus mode toggle
            document.getElementById('focusToggle').addEventListener('click', () => {
                document.body.classList.toggle('focus-mode');
            });

            // Export functionality
            document.getElementById('exportBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('exportMenu').classList.toggle('active');
            });

            document.addEventListener('click', () => {
                document.getElementById('exportMenu').classList.remove('active');
            });

            document.getElementById('copyHtml').addEventListener('click', () => {
                const html = editor.getHTML();
                navigator.clipboard.writeText(html);
                showToast('HTML copied to clipboard');
            });

            document.getElementById('copyMarkdown').addEventListener('click', () => {
                const html = editor.getHTML();
                const markdown = turndownService.turndown(html);
                navigator.clipboard.writeText(markdown);
                showToast('Markdown copied to clipboard');
            });

            document.getElementById('downloadHtml').addEventListener('click', () => {
                const html = editor.getHTML();
                const fullHtml = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MonoDraft Export</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 750px; margin: 40px auto; padding: 20px; line-height: 1.6; }
        h1 { font-size: 2.5em; margin: 0.5em 0; }
        h2 { font-size: 2em; margin: 0.5em 0; }
        h3 { font-size: 1.5em; margin: 0.5em 0; }
        blockquote { border-left: 4px solid #5c7cfa; padding-left: 1em; color: #666; font-style: italic; }
        pre { background: #f4f4f4; padding: 1em; border-radius: 6px; overflow-x: auto; }
        code { background: #f4f4f4; padding: 0.2em 0.4em; border-radius: 3px; }
    </style>
</head>
<body>
${html}
</body>
</html>`;
                downloadFile('document.html', fullHtml);
            });

            document.getElementById('downloadMarkdown').addEventListener('click', () => {
                const html = editor.getHTML();
                const markdown = turndownService.turndown(html);
                const timestamp = new Date().toISOString().split('T')[0];
                const frontmatter = `---
title: Document
date: ${timestamp}
---

`;
                downloadFile('document.md', frontmatter + markdown);
            });

            function downloadFile(filename, content) {
                const element = document.createElement('a');
                element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
                element.setAttribute('download', filename);
                element.style.display = 'none';
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
                showToast(`Downloaded ${filename}`);
            }

            // Stats update
            function updateStats() {
                const text = editor.getText();
                const words = text.trim().split(/\s+/).filter(word => word.length > 0).length;
                const chars = text.length;
                document.getElementById('wordCount').textContent = `${words} word${words !== 1 ? 's' : ''}`;
                document.getElementById('charCount').textContent = `${chars} character${chars !== 1 ? 's' : ''}`;
            }

            // Auto-save
            function autoSave() {
                clearTimeout(saveTimer);
                document.getElementById('saveStatus').textContent = 'Saving...';

                saveTimer = setTimeout(() => {
                    const content = editor.getHTML();
                    localStorage.setItem('monoDraftContent', content);
                    localStorage.setItem('monoDraftSaveTime', new Date().toISOString());
                    document.getElementById('saveStatus').textContent = 'Saved';
                }, 500);
            }

            // Time display
            function updateTime() {
                const now = new Date();
                const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                document.getElementById('currentTime').textContent = time;
            }
            updateTime();
            setInterval(updateTime, 60000);

            // Toast notifications
            function showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Focus mode: Escape key
                if (e.key === 'Escape') {
                    document.body.classList.toggle('focus-mode');
                }

                // View toggle: Cmd/Ctrl + Shift + V
                if ((e.metaKey || e.ctrlKey) && e.shiftKey && e.key === 'V') {
                    e.preventDefault();
                    toggleView();
                }
            });

            // Update selection state
            editor.on('selectionUpdate', () => {
                updateToolbarState();
            });

            // Initial stats
            updateStats();
        }
    </script>
</body>
</html>